{"version":3,"file":"commonjs.js","sources":["../index.js"],"sourcesContent":["/*\n  @flow weak\n */\n\nimport React from 'react'; // peer-dependency\nimport mitt from 'mitt'; // DEPENDENCY #1\nimport PropTypes from 'prop-types'; // DEPENDENCY #2, sorta\n\nif (!PropTypes) console.warn('<react-native-portal> no PropTypes available');\n\nconst oContextTypes = {\n  portalSub: PropTypes.func,\n  portalUnsub: PropTypes.func,\n  portalSet: PropTypes.func,\n  portalGet: PropTypes.func,\n};\n\nexport class PortalProvider extends React.Component {\n  _emitter: *;\n  static childContextTypes = oContextTypes;\n\n  portals = new Map();\n\n  getChildContext() {\n    return {\n      portalSub: this.portalSub,\n      portalUnsub: this.portalUnsub,\n      portalSet: this.portalSet,\n      portalGet: this.portalGet,\n    };\n  }\n\n  componentWillMount() {\n    this._emitter = new mitt();\n  }\n\n  componentWillUnmount() {\n    this._emitter = null;\n  }\n\n  // 변경시 통지 요청 등록\n  portalSub = (name, callback) => {\n    const emitter = this._emitter;\n    if (emitter) {\n      emitter.on(name, callback);\n    }\n  };\n\n  // 변경시 통지 요청 해제\n  portalUnsub = (name, callback) => {\n    const emitter = this._emitter;\n    if (emitter) {\n      emitter.off(name, callback);\n    }\n  };\n\n  // 변경\n  portalSet = (name, value) => {\n    this.portals.set(name, value);\n    if (this._emitter) {\n      this._emitter.emit(name);\n    }\n  };\n\n  portalGet = name => this.portals.get(name) || null;\n\n  // 변경\n  render() {\n    return this.props.children;\n  }\n}\n\nexport class BlackPortal extends React.PureComponent {\n  static contextTypes = oContextTypes;\n  props: {\n    name: string,\n    children?: *,\n  };\n  componentDidMount() {\n    const { name, children } = this.props;\n    const { portalSet } = this.context;\n    portalSet && portalSet(name, children);\n  }\n  componentWillReceiveProps(newProps) {\n    const oldProps = this.props;\n    const { name, children } = newProps;\n    const { portalSet } = this.context;\n    if (oldProps.children != newProps.children) {\n      portalSet && portalSet(name, children);\n    }\n  }\n  componentWillUnmount() {\n    const { name } = this.props;\n    const { portalSet } = this.context;\n    portalSet && portalSet(name, null);\n  }\n  render() {\n    const { name } = this.props;\n    return null;\n  }\n}\n\nexport class WhitePortal extends React.PureComponent {\n  static contextTypes = oContextTypes;\n  props: {\n    name: string,\n    children?: *,\n    childrenProps?: *,\n  };\n  componentWillMount() {\n    const { name } = this.props;\n    const { portalSub } = this.context;\n    portalSub && portalSub(name, this.forceUpdater);\n  }\n  componentWillUnmount() {\n    const { name } = this.props;\n    const { portalUnsub } = this.context;\n    portalUnsub && portalUnsub(name, this.forceUpdater);\n  }\n  forceUpdater = () => this.forceUpdate();\n\n  render() {\n    const { name, children, childrenProps } = this.props;\n    const { portalGet } = this.context;\n    const portalChildren = (portalGet && portalGet(name)) || children;\n    return (\n      (childrenProps && portalChildren\n        ? React.cloneElement(React.Children.only(portalChildren), childrenProps)\n        : portalChildren) || null\n    );\n  }\n}\n"],"names":["PropTypes","console","warn","oContextTypes","func","PortalProvider","portals","Map","portalSub","name","callback","emitter","_emitter","on","portalUnsub","off","portalSet","value","set","emit","portalGet","get","mitt","props","children","React","Component","childContextTypes","BlackPortal","context","newProps","oldProps","PureComponent","contextTypes","WhitePortal","forceUpdater","forceUpdate","childrenProps","portalChildren","cloneElement","Children","only"],"mappings":"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"}